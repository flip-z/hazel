# Hazel

Hazel is a local, filesystem-first project operating system for multi-repo work.
It is nexus-only: one workspace `.hazel/` tracks many repos and stores all Hazel state outside tracked repositories.

## Core Principles

- Filesystem is canonical.
- Nexus mode is the only mode.
- One binary (`hazel`) with local UI + CLI.
- Human-usable first, agent-augmented second.
- No required OpenAI API integration in Hazel.

## Build + Install

```sh
make build
./bin/hazel --help
go install ./cmd/hazel
```

## Getting Started

Initialize nexus root:

```sh
hazel init /path/to/nexus-root
```

Optional explicit scan root:

```sh
hazel init /path/to/nexus-root --projects-root /path/to/parent/dir
```

Start UI:

```sh
hazel up
```

Hazel stores active nexus root in `~/.hazel/active_root`, so `hazel up/down/run/doctor` work from anywhere.

## Canonical Layout

```text
<nexus-root>/
  .hazel/
    config.yaml
    projects/
      <project-key>/
        .hazel/
          board.yaml
          config.yaml
          tasks/
            HZ-0001/
              task.md
              impl.md
              plan.md
          runs/
          chat/
            sessions/*.jsonl
          wiki/
            README.md
            FEATURES_AND_USAGE.md
            SOURCE_README.md
            CHANGELOG.md
```

## Task Model

Board status:

- `BACKLOG`
- `READY`
- `ACTIVE`
- `REVIEW`
- `DONE`

Task artifacts:

- `task.md`: human intent + acceptance criteria + hidden Hazel config block
- `impl.md`: implementation details and execution output
- `plan.md`: temporary plan proposal generated by `hazel plan` (accept replaces `task.md`; decline deletes it)

Task-local Hazel config currently supports:

- visual metadata: `color`, `priority`
- git metadata:
  - `branch`
  - `base`
  - `last_commit`
  - `pr_url`
  - `merge_sha`
  - `merged_at`

## UI Model

- Nexus dashboard has 4 widgets:
  - Board
  - Chat
  - Wiki
  - History
- Widgets can expand to full-width.
- Project tabs live in the global header.
- Back navigation returns to dashboard shell (`/?project=<key>`).

## Chat + History Model

- Chat runs through Codex app-server integration.
- Session events persist to per-project JSONL history.
- History is task-centric and opens directly into chat context.
- Approvals are inline (`Accept` / `Decline`).
- Approval policy supports `on-request` and `never`.

## Git Flow in Tasks

Task page Git actions:

- `Start Branch`
  - checks out base branch (default `main`)
  - creates/switches `task/<id>-<slug>`
  - moves task to `ACTIVE`
- `Commit`
  - runs `git add -A` + `git commit`
  - records `last_commit`
- `Open PR`
  - pushes branch
  - runs `gh pr create`
  - records `pr_url`
  - moves task to `REVIEW`
- `Mark Merged`
  - records merge SHA + timestamp
  - moves task to `DONE`

Status guardrails:

- cannot set `REVIEW` without `pr_url`
- cannot set `DONE` without `merge_sha`

## CLI Surface

```text
hazel init <path> [--projects-root DIR]
hazel up
hazel down
hazel run
hazel plan HZ-0001
hazel sync-wiki [--project KEY]
hazel export --html
hazel export --chatgpt-project
hazel archive [--before DATE]
hazel doctor
hazel config [--github-token TOKEN] [--clear-github-token] [--git-base-branch BRANCH]
```

Useful examples:

```sh
hazel sync-wiki
hazel sync-wiki --project <project-key>
hazel export --chatgpt-project
hazel config --github-token <token>
hazel config --git-base-branch main
hazel config --clear-github-token
```

## Configuration

Top-level nexus config (`.hazel/config.yaml`) keys:

- `projects_root_dir`
- `port`
- `run_interval_seconds`
- `scheduler_enabled`
- `agent_command`
- `agent_plan_command`
- `agent_implement_command`
- `agent_chat_command`
- `codex_approval_policy`
- `github_token`
- `git_base_branch`
- `enable_enrichment`
- `enable_runs`
- `ui_hide_done_by_default`

Example:

```yaml
codex_approval_policy: on-request
github_token: ""
git_base_branch: main
```

## Codex + ChatGPT Architecture (No API)

Hazel assumes:

- Codex CLI with ChatGPT sign-in
- local-first orchestration
- no required OpenAI API key wiring in Hazel

Execution surfaces:

- Codex Chat (primary runtime for task sessions)
- CLI (`hazel plan`, `hazel run`) for deterministic scripted workflows
- ChatGPT Projects as optional long-horizon conversational memory

Why this is efficient without API spend:

- uses existing ChatGPT/Codex account entitlements
- keeps durable context local and diffable
- avoids hosted orchestration costs

## Current Risks / Gaps

- Plan and implementation flow need a stronger unified lifecycle.
- Wiki browsing needs better hierarchy/index/search and memory ergonomics.
- GitHub PR flow depends on local `git` + `gh` and operator token setup.

## Next Two Major Steps

1. Plan + Implementation Flow Refactor
- unify lifecycle semantics across `plan`, `run`, and chat-driven execution
- make status transitions deterministic and policy-driven
- reduce duplicated orchestration paths
- improve acceptance-criteria traceability

2. Wiki Overhaul for Usability + Long-Term Agent Memory
- improve navigation beyond flat long-scroll reading
- add stronger hierarchy, indexing/search, and page typing
- improve compact/full modes across widgets
- add memory-oriented summaries and recency signals

## Releases + Homebrew

This repo includes:

- `.github/workflows/release.yml`
- `.goreleaser.yaml`

Release:

```sh
git tag v0.1.0
git push --tags
```

Install:

```sh
brew tap flip-z/hazel
brew install hazel-cli
```
